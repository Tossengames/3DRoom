<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>Room Arranger 3D</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@400;500;600&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0f0f11;--surface:#18181c;--surface2:#222228;--border:#2e2e38;
  --accent:#5b8cff;--accent2:#ff6b6b;--text:#e8e8f0;--text2:#8888a0;
  --panel-w:260px;--props-w:240px;--topbar-h:48px;
  --bot-h:58px;--safe-bot:env(safe-area-inset-bottom,0px);
}
html,body{height:100%;height:100dvh;overflow:hidden;background:var(--bg);color:var(--text);
  font-family:'DM Sans',sans-serif;-webkit-tap-highlight-color:transparent;touch-action:none}

/* ── Topbar ── */
#topbar{position:fixed;top:0;left:0;right:0;height:var(--topbar-h);background:var(--surface);
  border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 10px;gap:6px;z-index:200}
.logo{font-family:'DM Mono',monospace;font-size:13px;letter-spacing:.1em;color:var(--accent);
  font-weight:500;flex-shrink:0;margin-right:2px}
.tb-sep{width:1px;height:22px;background:var(--border);flex-shrink:0}
.tb-btn{height:32px;padding:0 10px;border:1px solid var(--border);border-radius:6px;background:transparent;
  color:var(--text2);font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;transition:all .15s;
  display:flex;align-items:center;gap:5px;white-space:nowrap;flex-shrink:0;user-select:none;-webkit-user-select:none}
.tb-btn:active,.tb-btn:hover{color:var(--text);border-color:var(--accent);background:rgba(91,140,255,.1)}
.tb-btn.active{color:var(--accent);border-color:var(--accent);background:rgba(91,140,255,.12)}
.tb-spacer{flex:1}
.tb-lbl{display:inline}

/* ── Shell ── */
#shell{position:fixed;top:var(--topbar-h);left:0;right:0;bottom:0;display:flex;overflow:hidden}

/* ── Left panel ── */
#panel-left{width:var(--panel-w);background:var(--surface);border-right:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;z-index:100}
.panel-hdr{padding:11px 14px 9px;font-size:10px;letter-spacing:.12em;text-transform:uppercase;
  color:var(--text2);font-family:'DM Mono',monospace;border-bottom:1px solid var(--border);font-weight:500}
#model-search{margin:10px 12px;padding:8px 10px;background:var(--surface2);border:1px solid var(--border);
  border-radius:6px;color:var(--text);font-size:14px;font-family:'DM Sans',sans-serif;outline:none;
  transition:border-color .15s;flex-shrink:0}
#model-search:focus{border-color:var(--accent)}
#model-search::placeholder{color:var(--text2)}
#model-list{flex:1;overflow-y:auto;padding:4px 8px 12px;-webkit-overflow-scrolling:touch;
  scrollbar-width:thin;scrollbar-color:var(--border) transparent}
.cat-lbl{font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--text2);
  font-family:'DM Mono',monospace;padding:10px 10px 4px;font-weight:500}
.model-item{padding:10px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:10px;
  margin-bottom:2px;border:1px solid transparent;transition:background .12s;user-select:none;-webkit-user-select:none}
.model-item:active,.model-item:hover{background:var(--surface2);border-color:var(--border)}
.m-icon{width:38px;height:38px;background:var(--surface2);border-radius:8px;display:flex;
  align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.m-info{min-width:0;flex:1}
.m-name{font-size:13px;font-weight:500;color:var(--text)}
.m-meta{font-size:11px;color:var(--text2);margin-top:1px;font-family:'DM Mono',monospace;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.m-add{flex-shrink:0;width:28px;height:28px;border-radius:50%;background:rgba(91,140,255,.12);
  border:1px solid rgba(91,140,255,.3);color:var(--accent);display:flex;align-items:center;
  justify-content:center;font-size:18px;line-height:1}

/* ── Viewport ── */
#viewport{flex:1;position:relative;overflow:hidden;background:#0a0a0e}
#three-canvas{position:absolute;inset:0;display:block;width:100%!important;height:100%!important;touch-action:none}

/* Gizmo toolbar */
#gizmo-toolbar{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;gap:3px;
  background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:3px;z-index:10}
.gizmo-btn{height:36px;padding:0 12px;border-radius:6px;border:none;background:transparent;color:var(--text2);
  font-family:'DM Mono',monospace;font-size:11px;cursor:pointer;transition:all .12s;display:flex;
  align-items:center;gap:5px;user-select:none;-webkit-user-select:none}
.gizmo-btn:active,.gizmo-btn:hover{color:var(--text);background:var(--surface2)}
.gizmo-btn.active{color:var(--accent);background:rgba(91,140,255,.15)}
.glbl{} /* hidden on mobile via media query */

#selected-indicator{position:absolute;top:10px;right:10px;background:var(--surface);
  border:1px solid var(--accent);border-radius:6px;padding:5px 10px;font-size:11px;
  font-family:'DM Mono',monospace;color:var(--accent);display:none;max-width:160px;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;z-index:10}
#selected-indicator.visible{display:block}

#statusbar{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);
  background:rgba(24,24,28,.92);border:1px solid var(--border);border-radius:6px;
  padding:5px 12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--text2);
  pointer-events:none;white-space:nowrap;max-width:92vw;overflow:hidden;text-overflow:ellipsis;z-index:10}

/* ── Right panel ── */
#panel-right{width:var(--props-w);background:var(--surface);border-left:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:thin;scrollbar-color:var(--border) transparent;z-index:100}
.prop-sec{border-bottom:1px solid var(--border);padding:12px 14px}
.prop-ttl{font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--text2);
  font-family:'DM Mono',monospace;font-weight:500;margin-bottom:9px}
.prop-row{display:flex;align-items:center;gap:8px;margin-bottom:7px}
.prop-lbl{font-size:11px;color:var(--text2);width:18px;font-family:'DM Mono',monospace;flex-shrink:0}
.prop-inp{flex:1;min-width:0;background:var(--surface2);border:1px solid var(--border);border-radius:5px;
  padding:6px 8px;color:var(--text);font-size:13px;font-family:'DM Mono',monospace;outline:none;
  transition:border-color .15s}
.prop-inp:focus{border-color:var(--accent)}
.room-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.room-lbl{font-size:11px;color:var(--text2);width:52px;font-family:'DM Mono',monospace;flex-shrink:0}
.unit{font-size:11px;color:var(--text2);font-family:'DM Mono',monospace;flex-shrink:0}
.apply-btn{width:100%;padding:9px;background:rgba(91,140,255,.12);border:1px solid rgba(91,140,255,.3);
  border-radius:6px;color:var(--accent);font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif;
  font-weight:500;transition:background .15s;margin-top:4px}
.apply-btn:active,.apply-btn:hover{background:rgba(91,140,255,.22)}
.danger-btn{width:100%;padding:9px;background:rgba(255,107,107,.08);border:1px solid rgba(255,107,107,.22);
  border-radius:6px;color:var(--accent2);font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif;
  transition:background .15s;margin-top:4px}
.danger-btn:active,.danger-btn:hover{background:rgba(255,107,107,.18)}
.no-sel-msg{padding:18px 14px;text-align:center;color:var(--text2);font-size:12px;line-height:1.65}
.sk-grid{display:grid;grid-template-columns:auto 1fr;gap:3px 10px;font-size:11px;
  font-family:'DM Mono',monospace;color:var(--text2);line-height:1.9}
.sk-grid .k{color:var(--text)}

/* ── Loading ── */
#loading-overlay{position:fixed;inset:0;background:rgba(10,10,14,.92);display:flex;flex-direction:column;
  align-items:center;justify-content:center;z-index:9999;gap:14px;transition:opacity .3s}
#loading-overlay.hidden{opacity:0;pointer-events:none}
.spinner{width:32px;height:32px;border:2px solid var(--border);border-top-color:var(--accent);
  border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:'DM Mono',monospace;font-size:12px;color:var(--text2)}

/* ═══════════════════════════════════
   MOBILE-ONLY UI
═══════════════════════════════════ */
#bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;
  height:calc(var(--bot-h) + var(--safe-bot));padding-bottom:var(--safe-bot);
  background:var(--surface);border-top:1px solid var(--border);z-index:300;
  align-items:center;justify-content:space-around;padding-left:2px;padding-right:2px}
.nav-btn{flex:1;max-width:64px;height:50px;border:none;background:transparent;color:var(--text2);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;
  border-radius:8px;cursor:pointer;transition:all .12s;user-select:none;-webkit-user-select:none;
  font-size:9px;font-family:'DM Sans',sans-serif}
.nav-btn:active,.nav-btn.active{color:var(--accent);background:rgba(91,140,255,.1)}
.nav-btn.del-btn:active{color:var(--accent2);background:rgba(255,107,107,.1)}

#fab-add{display:none;position:fixed;bottom:calc(var(--bot-h) + var(--safe-bot) + 12px);right:14px;
  width:52px;height:52px;border-radius:50%;background:var(--accent);border:none;color:#fff;
  font-size:26px;cursor:pointer;z-index:250;box-shadow:0 4px 20px rgba(91,140,255,.45);
  align-items:center;justify-content:center;transition:transform .15s;user-select:none}
#fab-add:active{transform:scale(.92)}

/* Sheet overlay */
.sh-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:399;backdrop-filter:blur(2px)}
.sh-overlay.open{display:block}
/* Sheet */
.bsheet{position:fixed;left:0;right:0;bottom:0;background:var(--surface);border-radius:16px 16px 0 0;
  border-top:1px solid var(--border);z-index:400;display:flex;flex-direction:column;
  transform:translateY(100%);transition:transform .3s cubic-bezier(.32,.72,0,1);max-height:82dvh}
.bsheet.open{transform:translateY(0)}
.sh-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:10px auto 0;flex-shrink:0}
.sh-title{font-family:'DM Mono',monospace;font-size:11px;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text2);text-align:center;padding:7px 0 3px;flex-shrink:0}
#sh-model-search{margin:8px 12px;padding:10px 12px;background:var(--surface2);border:1px solid var(--border);
  border-radius:8px;color:var(--text);font-size:16px;font-family:'DM Sans',sans-serif;outline:none;flex-shrink:0}
#sh-model-search:focus{border-color:var(--accent)}
#sh-model-list{flex:1;overflow-y:auto;padding:4px 8px calc(var(--safe-bot) + 14px);-webkit-overflow-scrolling:touch}
/* props sheet */
#sh-props-body{flex:1;overflow-y:auto;padding:10px 14px calc(var(--safe-bot) + 14px);
  -webkit-overflow-scrolling:touch;display:flex;flex-direction:column;gap:14px}
.sh-sec-ttl{font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--text2);
  font-family:'DM Mono',monospace;font-weight:500;margin-bottom:8px}
.sh-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.sh-lbl{font-size:12px;color:var(--text2);width:20px;font-family:'DM Mono',monospace;flex-shrink:0}
.sh-inp{flex:1;min-width:0;background:var(--surface2);border:1px solid var(--border);border-radius:6px;
  padding:10px 10px;color:var(--text);font-size:16px;font-family:'DM Mono',monospace;outline:none}
.sh-inp:focus{border-color:var(--accent)}

/* ── Responsive ── */
@media(max-width:768px){
  :root{--topbar-h:44px}
  #panel-left,#panel-right{display:none}
  #bottom-nav{display:flex}
  #fab-add{display:flex}
  #shell{bottom:calc(var(--bot-h) + var(--safe-bot))}
  .gizmo-btn{height:40px;padding:0 9px;font-size:12px}
  .glbl{display:none}
  .tb-lbl{display:none}
  .tb-btn{padding:0 8px;min-width:34px;justify-content:center}
  .tb-sep{display:none}
  #topbar{gap:3px}
}
@media(min-width:769px){
  .sh-overlay,.bsheet,#bottom-nav,#fab-add{display:none!important}
}
</style>
</head>
<body>

<div id="loading-overlay">
  <div class="spinner"></div>
  <div class="loading-text">Initializing Room Arranger…</div>
</div>

<!-- Topbar -->
<div id="topbar">
  <span class="logo">⬛ ROOM3D</span>
  <div class="tb-sep"></div>
  <button class="tb-btn" id="btn-reset-cam">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
    <span class="tb-lbl">Reset</span>
  </button>
  <button class="tb-btn" id="btn-top-view">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 3v18"/></svg>
    <span class="tb-lbl">Top</span>
  </button>
  <button class="tb-btn active" id="btn-toggle-grid">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/></svg>
    <span class="tb-lbl">Grid</span>
  </button>
  <button class="tb-btn active" id="btn-toggle-walls">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M3 15h18M9 3v18M15 3v18"/></svg>
    <span class="tb-lbl">Walls</span>
  </button>
  <div class="tb-spacer"></div>
  <button class="tb-btn" id="btn-deselect">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
    <span class="tb-lbl">Deselect</span>
  </button>
  <button class="tb-btn" id="btn-delete" style="color:var(--accent2);border-color:rgba(255,107,107,.25)">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
    <span class="tb-lbl">Delete</span>
  </button>
</div>

<div id="shell">
  <!-- Desktop left panel -->
  <div id="panel-left">
    <div class="panel-hdr">Model Library</div>
    <input type="text" id="model-search" placeholder="Search models…">
    <div id="model-list">
      <div style="padding:28px 14px;text-align:center;color:var(--text2);font-size:12px;line-height:1.8">
        <div class="spinner" style="margin:0 auto 12px"></div>Fetching models…
      </div>
    </div>
  </div>

  <!-- Viewport -->
  <div id="viewport">
    <canvas id="three-canvas"></canvas>

    <div id="gizmo-toolbar">
      <button class="gizmo-btn active" data-mode="translate">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3"/><path d="M2 12h20M12 2v20"/></svg>
        <span class="glbl">Move</span>
      </button>
      <button class="gizmo-btn" data-mode="rotate">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.5 2v6h-6M2.5 22v-6h6"/><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"/></svg>
        <span class="glbl">Rotate</span>
      </button>
      <button class="gizmo-btn" data-mode="scale">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6M9 21H3v-6"/><path d="M21 3l-7 7M3 21l7-7"/></svg>
        <span class="glbl">Scale</span>
      </button>
    </div>

    <div id="selected-indicator"></div>
    <div id="statusbar">Tap a model to add • 1-finger orbit • pinch zoom</div>
  </div>

  <!-- Desktop right panel -->
  <div id="panel-right">
    <div class="panel-hdr">Properties</div>
    <div class="prop-sec">
      <div class="prop-ttl">Room Size</div>
      <div class="room-row"><span class="room-lbl">Width</span><input type="number" class="prop-inp" id="room-width" value="10" min="2" max="50" step="0.5"><span class="unit">m</span></div>
      <div class="room-row"><span class="room-lbl">Length</span><input type="number" class="prop-inp" id="room-length" value="8" min="2" max="50" step="0.5"><span class="unit">m</span></div>
      <div class="room-row"><span class="room-lbl">Height</span><input type="number" class="prop-inp" id="room-height" value="3" min="2" max="10" step="0.5"><span class="unit">m</span></div>
      <button class="apply-btn" id="btn-apply-room">Apply Room Size</button>
    </div>
    <div class="prop-sec" id="obj-props" style="display:none">
      <div class="prop-ttl" id="obj-name-title">Object</div>
      <div class="prop-ttl" style="margin-top:2px">Position</div>
      <div class="prop-row"><span class="prop-lbl">X</span><input type="number" class="prop-inp" id="prop-px" step="0.1"></div>
      <div class="prop-row"><span class="prop-lbl">Z</span><input type="number" class="prop-inp" id="prop-pz" step="0.1"></div>
      <div class="prop-ttl" style="margin-top:8px">Rotation Y</div>
      <div class="prop-row"><span class="prop-lbl">°</span><input type="number" class="prop-inp" id="prop-ry" step="1"></div>
      <div class="prop-ttl" style="margin-top:8px">Scale</div>
      <div class="prop-row"><span class="prop-lbl">X</span><input type="number" class="prop-inp" id="prop-sx" step="0.05" min="0.01"></div>
      <div class="prop-row"><span class="prop-lbl">Y</span><input type="number" class="prop-inp" id="prop-sy" step="0.05" min="0.01"></div>
      <div class="prop-row"><span class="prop-lbl">Z</span><input type="number" class="prop-inp" id="prop-sz" step="0.05" min="0.01"></div>
      <button class="danger-btn" id="btn-delete-prop">Delete Object</button>
    </div>
    <div class="no-sel-msg" id="no-select-msg">Select an object in the scene to edit its properties.</div>
    <div class="prop-sec" style="margin-top:auto">
      <div class="prop-ttl">Shortcuts</div>
      <div class="sk-grid">
        <span class="k">W</span><span>Move</span>
        <span class="k">E</span><span>Rotate</span>
        <span class="k">R</span><span>Scale</span>
        <span class="k">Del</span><span>Delete</span>
        <span class="k">Esc</span><span>Deselect</span>
        <span class="k">RMB</span><span>Orbit</span>
        <span class="k">MMB</span><span>Pan</span>
        <span class="k">Scroll</span><span>Zoom</span>
      </div>
    </div>
  </div>
</div>

<!-- Mobile bottom nav -->
<div id="bottom-nav">
  <button class="nav-btn" id="nav-models">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
    Models
  </button>
  <button class="nav-btn" id="nav-move" data-mode="translate">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3"/><path d="M2 12h20M12 2v20"/></svg>
    Move
  </button>
  <button class="nav-btn" id="nav-rotate" data-mode="rotate">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21.5 2v6h-6M2.5 22v-6h6"/><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"/></svg>
    Rotate
  </button>
  <button class="nav-btn" id="nav-scale" data-mode="scale">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M15 3h6v6M9 21H3v-6"/><path d="M21 3l-7 7M3 21l7-7"/></svg>
    Scale
  </button>
  <button class="nav-btn" id="nav-props">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    Props
  </button>
  <button class="nav-btn del-btn" id="nav-delete">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
    Delete
  </button>
</div>

<button id="fab-add" aria-label="Add model">＋</button>

<!-- Sheet overlay -->
<div class="sh-overlay" id="sh-overlay"></div>

<!-- Models sheet -->
<div class="bsheet" id="sh-models">
  <div class="sh-handle"></div>
  <div class="sh-title">Add Model</div>
  <input type="text" id="sh-model-search" placeholder="Search…">
  <div id="sh-model-list"></div>
</div>

<!-- Props sheet -->
<div class="bsheet" id="sh-props">
  <div class="sh-handle"></div>
  <div class="sh-title" id="sh-props-title">Properties</div>
  <div id="sh-props-body">
    <div>
      <div class="sh-sec-ttl">Room Size</div>
      <div class="sh-row"><span class="sh-lbl">W</span><input type="number" class="sh-inp" id="sh-room-w" value="10" min="2" max="50" step="0.5"><span style="font-size:12px;color:var(--text2);padding-left:4px;font-family:DM Mono,monospace">m</span></div>
      <div class="sh-row"><span class="sh-lbl">L</span><input type="number" class="sh-inp" id="sh-room-l" value="8" min="2" max="50" step="0.5"><span style="font-size:12px;color:var(--text2);padding-left:4px;font-family:DM Mono,monospace">m</span></div>
      <div class="sh-row"><span class="sh-lbl">H</span><input type="number" class="sh-inp" id="sh-room-h" value="3" min="2" max="10" step="0.5"><span style="font-size:12px;color:var(--text2);padding-left:4px;font-family:DM Mono,monospace">m</span></div>
      <button class="apply-btn" id="sh-apply-room">Apply Room Size</button>
    </div>
    <div id="sh-obj-sec" style="display:none">
      <div class="sh-sec-ttl" id="sh-obj-name">Object</div>
      <div class="sh-sec-ttl" style="margin-top:4px">Position</div>
      <div class="sh-row"><span class="sh-lbl">X</span><input type="number" class="sh-inp" id="sh-px" step="0.1"></div>
      <div class="sh-row"><span class="sh-lbl">Z</span><input type="number" class="sh-inp" id="sh-pz" step="0.1"></div>
      <div class="sh-sec-ttl" style="margin-top:8px">Rotation Y</div>
      <div class="sh-row"><span class="sh-lbl">°</span><input type="number" class="sh-inp" id="sh-ry" step="1"></div>
      <div class="sh-sec-ttl" style="margin-top:8px">Scale</div>
      <div class="sh-row"><span class="sh-lbl">X</span><input type="number" class="sh-inp" id="sh-sx" step="0.05" min="0.01"></div>
      <div class="sh-row"><span class="sh-lbl">Y</span><input type="number" class="sh-inp" id="sh-sy" step="0.05" min="0.01"></div>
      <div class="sh-row"><span class="sh-lbl">Z</span><input type="number" class="sh-inp" id="sh-sz" step="0.05" min="0.01"></div>
      <button class="danger-btn" id="sh-delete">Delete Object</button>
    </div>
    <div id="sh-no-sel" style="text-align:center;color:var(--text2);font-size:13px;line-height:1.7;padding:4px 0">
      Select an object to edit, or adjust room size above.
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="room-arranger.js"></script>
<script>
// ── Mobile sheet controller ──────────────────────────────────────────
const shOverlay  = document.getElementById('sh-overlay');
const shModels   = document.getElementById('sh-models');
const shProps    = document.getElementById('sh-props');

function openSheet(el){ closeSheets(); shOverlay.classList.add('open'); el.classList.add('open'); }
function closeSheets(){ shOverlay.classList.remove('open'); shModels.classList.remove('open'); shProps.classList.remove('open'); }
shOverlay.addEventListener('click', closeSheets);

document.getElementById('fab-add').addEventListener('click', ()=> openSheet(shModels));
document.getElementById('nav-models').addEventListener('click', ()=> openSheet(shModels));
document.getElementById('nav-props').addEventListener('click', ()=> openSheet(shProps));
document.getElementById('nav-delete').addEventListener('click', ()=>{ window.deleteSelected&&window.deleteSelected(); });

// Gizmo nav buttons
['nav-move','nav-rotate','nav-scale'].forEach(id=>{
  const b = document.getElementById(id);
  b.addEventListener('click', ()=>{
    window.setGizmoMode&&window.setGizmoMode(b.dataset.mode);
    document.querySelectorAll('.nav-btn[data-mode]').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
  });
});

// Mobile search
document.getElementById('sh-model-search').addEventListener('input', e=>{
  window.populateModelListMobile&&window.populateModelListMobile(e.target.value);
});

// Sync room inputs (mobile sheet ↔ desktop panel)
document.getElementById('sh-apply-room').addEventListener('click', ()=>{
  document.getElementById('room-width').value  = document.getElementById('sh-room-w').value;
  document.getElementById('room-length').value = document.getElementById('sh-room-l').value;
  document.getElementById('room-height').value = document.getElementById('sh-room-h').value;
  document.getElementById('btn-apply-room').click();
  closeSheets();
});
document.getElementById('btn-apply-room').addEventListener('click', ()=>{
  document.getElementById('sh-room-w').value = document.getElementById('room-width').value;
  document.getElementById('sh-room-l').value = document.getElementById('room-length').value;
  document.getElementById('sh-room-h').value = document.getElementById('room-height').value;
});

// Mobile prop inputs mirror desktop
const mmap=[['sh-px','prop-px'],['sh-pz','prop-pz'],['sh-ry','prop-ry'],
            ['sh-sx','prop-sx'],['sh-sy','prop-sy'],['sh-sz','prop-sz']];
mmap.forEach(([s,d])=>{
  document.getElementById(s).addEventListener('change', function(){
    const el=document.getElementById(d); el.value=this.value; el.dispatchEvent(new Event('change'));
  });
});
document.getElementById('sh-delete').addEventListener('click',()=>{
  window.deleteSelected&&window.deleteSelected(); closeSheets();
});

// Called by room-arranger.js when selection changes
window.onPropsUpdated=function(name,px,pz,ry,sx,sy,sz){
  document.getElementById('sh-obj-name').textContent=name;
  document.getElementById('sh-props-title').textContent=name;
  document.getElementById('sh-obj-sec').style.display='block';
  document.getElementById('sh-no-sel').style.display='none';
  document.getElementById('sh-px').value=px;
  document.getElementById('sh-pz').value=pz;
  document.getElementById('sh-ry').value=ry;
  document.getElementById('sh-sx').value=sx;
  document.getElementById('sh-sy').value=sy;
  document.getElementById('sh-sz').value=sz;
};
window.onDeselected=function(){
  document.getElementById('sh-obj-sec').style.display='none';
  document.getElementById('sh-no-sel').style.display='block';
  document.getElementById('sh-props-title').textContent='Properties';
};
</script>
</body>
</html>
